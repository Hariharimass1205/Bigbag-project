<%- include('../layouts/userHeader.ejs') %>
  
    <div class="container main-container headerOffset">
        <div class="row">
           
              <!-- LIGHT SECTION -->
      <section class="lightSection clearfix pageHeader">
        <div class="container">
          <div class="row">
            <div class="col-md-6">
              <div class="page-title">
                <h2>ALL ORDERS</h2>
              </div>
            </div>
            <div class="col-md-6">
              <ol class="breadcrumb float-right">
                <li>
                  <a href='/orders'>YOUR ORDERS</a>
                </li>
                <li class="active">ALL ORDERS</li>
              </ol>
            </div>
          </div>
        </div>
      </section>
         
 
        <div class="row">
            <div class="col-lg-9 col-md-9 col-sm-7">
                <h1 class="section-title-inner">
                    <span><i class="fa fa-list-alt"></i> Order Status </span>
                </h1>

                <div class="row userInfo">
                   

                    <div class="statusContent">
                        <div class="col-sm-12">
                            <div class="statusTop">
                                <p style="font-size: medium;"><strong style="font-size: medium;">Status:<%= orderData.orderStatus %></strong></p>
                                
                                <p><strong style="font-size: medium;">Order Date:</strong>
                                    <%= orderData.orderDate %>
                                </p>
                                <p><strong style="font-size: medium;">Order Number:</strong> #<%= orderData.orderNumber %>
                                </p>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <div id="cancelledBtn" style="display: none;" class="text-bg-danger p-3">This order has been
                                cancelled</div>
                        </div>

                        <% if (orderData.orderStatus=="Delivered" || orderData.orderStatus=="Return" ) { %>
                            <div class="col-sm-12">
                                <% if (isReturn) { %>
                                    <button class="btn btn-danger btn-lg btn-block">This order has been
                                        Returned</button>
                                    <% } else { %>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control" width="800px" id="ReturnReason"
                                                placeholder="Reason for cancellation">
                                            <br>
                                            <br>
                                            <br>
                                            <div class="input-group-append">
                                                <a href="#" id="returnorder" onclick="returnorderConfirmation('<%= orderData._id %>')">
                                                    <button class="btn btn-warning return">RETURN</button>
                                                </a>
                                            </div>
                                        </div>
                                        <% } %>
                            </div>
                            
                            <% } else { %>
                                <div class="col-sm-12">
                                    <% if (isCancelled) { %>
                                        <button class="btn btn-danger btn-lg btn-block">This order has been
                                            cancelled</button>
                                        <% } else { %>
                                            <div class="input-group mb-3">
                                                <input type="text" class="form-control" width="800px" id="cancelReason"
                                                    placeholder="Reason for cancellation">
                                                <br>
                                                <br>
                                                <br>
                                                <div class="input-group-append">
                                                    <button class="btn btn-danger" type="button"
                                                        onclick="cancelOrder('<%= orderData._id %>')">Cancel
                                                        Order</button>
                                                </div>
                                            </div>
                                            <% } %>
                                </div>
                                <% } %> 

                                    <div style="clear: both"></div>
                                    <br>
                                    <br>
                                    <div class="col-sm-6">
                                        <div class="order-box">
                                            <div class="order-box-header">Payment Method</div>
                                            <div class="order-box-content">
                                                <div class="address">
                                                    <p>
                                                        <%= orderData.paymentType %>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                    </div>

                    <div class="col-sm-12 clearfix">
                        <div class="order-box">
                            <div class="order-box-header">Order Items</div>

                            <div class="order-box-content">
                                <div class="table-responsive">
                                    <table class="order-details-cart">
                                        <tbody>
                                            <% orderData.cartData.forEach(function(cartItem) { %>
                                                <tr class="cartProduct">
                                                    <td class="cartProductThumb" style="width: 20%">
                                                        <div>
                                                            <a href="/productDetails/<%= cartItem.productId._id %>">
                                                                <img alt="img"
                                                                    src="/upload/<%= cartItem.productId.productImage1 %>" />
                                                            </a>
                                                        </div>
                                                    </td>
                                                    <td style="width: 40%">
                                                        <div class="miniCartDescription">
                                                            <h4>
                                                                <a href="product-details.html">
                                                                    <%= cartItem.productId.productName %>
                                                                </a>
                                                            </h4>
                                                            <div class="price"><span>
                                                                    <%= cartItem.productId.productName %>
                                                                </span></div>
                                                        </div>
                                                    </td>
                                                    <td class="" style="width: 10%"><a> X<%= cartItem.productQuantity %>
                                                        </a></td>
                                                    <td class="" style="width: 15%"><span> ₹<%=
                                                                cartItem.totalCostPerProduct %> </span></td>
                                                </tr>
                                                <% }); %>
                                                    <!-- Other rows for total, shipping, grand total -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-12 clearfix">
                    <ul class="pager">
                        <li class="previous pull-right">
                            <a href="/home">
                                <i class="fa fa-home"></i> Go to Shop
                            </a>
                        </li>
                        <li class="next pull-left">
                            <a href="/account"> ← Back to My Account</a>
                        </li>
                    </ul>
                </div>
            </div>
            <!--/row end-->
        </div>
        <div class="col-lg-3 col-md-3 col-sm-5"></div>
    </div>
    <!--/row-->

    <div style="clear: both"></div>
    </div>
    <!-- /main-container -->

    <!-- JavaScript imports and scripts remain the same -->

    <!-- Le javascript
================================================== -->

    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/assets/js/jquery/jquery-2.1.3.min.js"></script>
    <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
    <!-- include footable plugin -->
    <script src="/assets/js/footable.js" type="text/javascript"></script>
    <script src="/assets/js/footable.sortable.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            $(".footable").footable();
        });
    </script>

    <!-- include  parallax plugin -->
    <script type="text/javascript" src="/assets/js/jquery.parallax-1.1.js"></script>

    <!-- optionally include helper plugins -->
    <script type="text/javascript" src="/assets/js/helper-plugins/jquery.mousewheel.min.js"></script>

    <!-- include mCustomScrollbar plugin //Custom Scrollbar  -->

    <script type="text/javascript" src="/assets/js/jquery.mCustomScrollbar.js"></script>

    <!-- include icheck plugin // customized checkboxes and radio buttons   -->
    <script type="text/javascript" src="/assets/plugins/icheck-1.x/icheck.min.js"></script>

    <!-- include grid.js // for equal Div height  -->
    <script src="/assets/plugins/jquery-match-height-master/dist/jquery.matchHeight-min.js"></script>
    <script src="/assets/js/grids.js"></script>

    <!-- include carousel slider plugin  -->
    <script src="/assets/js/owl.carousel.min.js"></script>

    <!-- jQuery select2 // custom select   -->
    <script src="../../../../cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>

    <!-- include touchspin.js // touch friendly input spinner component   -->
    <script src="/assets/js/bootstrap.touchspin.js"></script>

    <!-- include custom script for site  -->
    <script src="/assets/js/script.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script>
      async function cancelOrder(orderId) {
  let cancelBtnElement = document.getElementById('cancelBtn');
  let reason = document.getElementById('cancelReason').value;

  let cancelledBtnElement = document.getElementById('597a5bdf082df5a383c94b');
  
  // Your Swal.fire confirmation dialog
  Swal.fire({
      title: "Are you sure?",
      text: "You won't be able to revert this!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, Cancel the order"
  }).then((result) => {
      if (result.isConfirmed) {
          fetch('/cancelOrder/' + orderId, {
              method: 'PUT',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify({ cancelReason: reason }),
          }).then(() => {
              location.reload();
          }).catch(error => console.error('Error:', error));
          
          cancelBtnElement.style.display = 'none';
          cancelledBtnElement.style.display = 'block';
      }
  });
}

async function returnorderConfirmation(orderId) {
  let reason = document.getElementById('ReturnReason').value;

  Swal.fire({
      title: "Are you sure?",
      text: "You won't be able to revert this!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, return the order"
  }).then((result) => {
      if (result.isConfirmed) {
          fetch('/returnorder/' + orderId, {
              method: 'PUT',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify({ ReturnReason: reason }),
          }).then(() => {
              location.reload();
          }).catch(error => console.error('Error:', error));

          let cancelBtnElement = document.getElementById('cancelBtn');
          let returnedBtnElement = document.getElementById('returnedBtn');
          cancelBtnElement.style.display = 'none';
          returnedBtnElement.style.display = 'block';
      }
  });
}





  </script>
</body>



<!-- Mirrored from templatecycle.com/tshop/v6/gray/order-status.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 09 Dec 2023 06:55:53 GMT -->



</html>
<%- include('../layouts/userFooter.ejs') %>